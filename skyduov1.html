<!DOCTYPE html>
<html>
<head>
    <title>Pebble Settings</title>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <link href=
    "http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.css" rel=
    "stylesheet">
    <script src="http://code.jquery.com/jquery-2.1.1.js">
    </script>
    <script src=
    "http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.js">
    </script>
    <style type='text/css'>
            .hidden {display: none; }
            #divs div { display:none; }
    </style>
</head>
<body>
    <div data-role="page" id="main">
        <div class="jqm-header" data-role="header">
            <h2>DUO Settings</h2>
        </div>
        <div data-role="fieldcontain">
            <div class="ui-body ui-body-a" data-role="content" id=
            "form-shower">
                <form>
                    <select id="mode" name="mode" style="width: 100%;">
                        <option value="none">
                            Select Mode (REQUIRED):
                        </option>
                        <option value="US_Share">
                            US-Share
                        </option>
                        <option value="Non_US_Share">
                            Non-US-Share
                        </option>
                        <option value="Nightscout">
                            Nightscout
                        </option>
                    </select>
                </form>
            </div>
            <div data-role="content" id="entry-forms">
                <form id="US_Share" name="US_Share" style="display:none">
                    <div data-role="fieldcontain">
                        <label for="t1name1"><strong>Top User Name:</strong></label>
                        <input id="t1name1" name="t1name1" type="text"> 
                        <label for="accountName">Share Username:</label> 
                        <input id="accountName" name="accountName" type="text" value=""> 
                        <label for="password">Share Password:</label> 
                        <input id="password" name="password" type="password" value="">
                    </div>
                    <div data-role="fieldcontain">
                        <label for="t1name2"><strong>Bottom User Name:</strong></label> 
                        <input id="t1name2" name="t1name2" type="text"> 
                        <label for="accountName2">Share Username:</label> 
                        <input id="accountName2" name="accountName2" type="text" value=""> 
                        <label for="password2">Share Password:</label> 
                        <input id="password2" name="password2" type="password" value="">
                    </div>
                </form>
                <form id="Non_US_Share" name="Non_US_Share" style=
                "display:none">
                    <div data-role="fieldcontain">
                        <label for="t1name1"><strong>Top User Name:</strong></label> 
                        <input id="t1name1" name="t1name1" type="text"> 
                        <label for="accountName">Share Username:</label> 
                        <input id="n_accountName" name="n_accountName" type="text" value=""> 
                        <label for="password">Share Password:</label> 
                        <input id="n_password" name="n_password" type="password" value="">
                    </div>
                    <div data-role="fieldcontain">
                        <label for="t1name2"><strong>Bottom User Name:</strong></label> 
                        <input id="t1name2" name="t1name2" type="text"> 
                        <label for="accountName2">Share Username:</label> 
                        <input id="n_accountName2" name="n_accountName2" type="text" value=""> 
                        <label for="password2">Share Password:</label> 
                        <input id="n_password2" name="n_password2" type="password" value="">
                    </div>
                </form>
                <form id="Nightscout" name="Nightscout" style="display:none">
                    <script>
                            function clearFunction() {
                                document.getElementById("message").innerHTML = "ie:https://name.azurewebsites.net/";
                            }
                    </script>
                    <div data-role="fieldcontain">
                        <label for="t1name1"><strong>Top User Name:</strong></label> 
                        <input id="t1name1" name="t1name1" type="text"> 
                        <label for="endpoint1"><strong>Website for User 1:</strong></label> 
                        <input id="endpoint1" name="endpoint1" type="text">
                        <div id="message">
                            ie:https://name.azurewebsites.net/
                        </div>
                    </div>
                    <div data-role="fieldcontain">
                        <label for="t1name2"><strong>Bottom User Name:</strong></label> 
                        <input id="t1name2" name="t1name2" type="text"> 
                        <label for="endpoint2"><strong>Website for User 2:</strong></label> 
                        <input id="endpoint2" name="endpoint2" type="text">
                        <div id="message">
                            ie:https://name.azurewebsites.net/
                        </div>
                    </div>
                </form><tt class="hidden" id="status"></tt>
            </div>
        </div>
        <div data-role="fieldcontain">
            <div data-role="content">
                <fieldset data-role="controlgroup" data-type="horizontal" id=
                "Radio_Options">
                    <legend><strong>Choose Units:</strong></legend> <input id=
                    "mgdl_form" name="units" onchange=
                    "onchange_handler(this, 'mgdl');" onclick="clearFunction()"
                    onmouseup="onchange_handler(this, 'mgdl');" type="radio"
                    value="mgdl_form"> <label for="mgdl_form">mg/dl</label>
                    <input id="mmol_form" name="units" onchange=
                    "onchange_handler(this, 'mmol');" onclick="myFunction()"
                    onmouseup="onchange_handler(this, //'mmol');" type="radio"
                    value="mmol_form"> <label for="mmol_form">mmol</label>
                </fieldset>
                <script>
                        function myFunction() {
                            document.getElementById("message").innerHTML = "ie:https://name.azurewebsites.net/";
                        }
                </script> 
                <script>
                        function clearFunction() {
                            document.getElementById("message").innerHTML = "ie:https://name.azurewebsites.net/";
                        }
                </script> <!-- If MG/DL Form is checked -->
                <div id="mgdl_form_fields">
                    <legend><strong>Vibration Settings</strong></legend>
                    <label for="mglowbg">Select Low BG Level</label>
                    <select id="mglowbg" name="mglowbg">
                        <option value="60">
                            60
                        </option>
                        <option value="65">
                            65
                        </option>
                        <option value="70">
                            70
                        </option>
                        <option value="75">
                            75
                        </option>
                        <option value="80">
                            80
                        </option>
                        <option value="90">
                            90
                        </option>
                        <option value="100">
                            100
                        </option>
                        <option value="110">
                            110
                        </option>
                        <option value="120">
                            120
                        </option>
                    </select> <label for="mghighbg">Select High BG
                    Level</label> <select id="mghighbg" name="mghighbg">
                        <option value="130">
                            130
                        </option>
                        <option value="140">
                            140
                        </option>
                        <option value="150">
                            150
                        </option>
                        <option value="160">
                            160
                        </option>
                        <option value="170">
                            170
                        </option>
                        <option value="180">
                            180
                        </option>
                        <option value="190">
                            190
                        </option>
                        <option value="200">
                            200
                        </option>
                        <option value="210">
                            210
                        </option>
                        <option value="220">
                            220
                        </option>
                        <option value="230">
                            230
                        </option>
                        <option value="240">
                            240
                        </option>
                        <option value="250">
                            250
                        </option>
                        <option value="260">
                            260
                        </option>
                        <option value="270">
                            270
                        </option>
                        <option value="280">
                            280
                        </option>
                        <option value="290">
                            290
                        </option>
                        <option value="300">
                            300
                        </option>
                    </select>
                </div><!-- If MMOL Form is checked -->
                <div id="mmol_form_fields" style="display: none;">
                    <legend><strong>Vibration Settings</strong></legend>
                    <label for="mmlowbg">Select Low BG Level</label>
                    <select id="mmlowbg" name="mmlowbg">
                        <option value="33">
                            3.3
                        </option>
                        <option value="36">
                            3.6
                        </option>
                        <option value="40">
                            4.0
                        </option>
                        <option value="45">
                            4.5
                        </option>
                        <option value="50">
                            5.0
                        </option>
                        <option value="55">
                            5.5
                        </option>
                        <option value="60">
                            6.0
                        </option>
                        <option value="65">
                            6.5
                        </option>
                    </select> <label for="mmhighbg">Select High BG
                    Level</label> <select id="mmhighbg" name="mmhighbg">
                        <option value="75">
                            7.5
                        </option>
                        <option value="80">
                            8.0
                        </option>
                        <option value="85">
                            8.5
                        </option>
                        <option value="90">
                            9.0
                        </option>
                        <option value="95">
                            9.5
                        </option>
                        <option value="100">
                            10.0
                        </option>
                        <option value="105">
                            10.5
                        </option>
                        <option value="110">
                            11.0
                        </option>
                        <option value="115">
                            11.5
                        </option>
                        <option value="120">
                            12.0
                        </option>
                        <option value="125">
                            12.5
                        </option>
                        <option value="130">
                            13.0
                        </option>
                        <option value="135">
                            13.5
                        </option>
                        <option value="140">
                            14.0
                        </option>
                        <option value="145">
                            14.5
                        </option>
                        <option value="150">
                            15.0
                        </option>
                        <option value="155">
                            15.5
                        </option>
                    </select>
                </div>
                <div>
                    <label for="lowsnooze">Select Low Snooze Minutes</label>
                    <select id="lowsnooze" name="lowsnooze">
                        <option value="5">
                            5
                        </option>
                        <option value="10">
                            10
                        </option>
                        <option value="15">
                            15
                        </option>
                        <option value="20">
                            20
                        </option>
                        <option value="25">
                            25
                        </option>
                        <option value="30">
                            30
                        </option>
                        <option value="35">
                            35
                        </option>
                        <option value="40">
                            40
                        </option>
                        <option value="45">
                            45
                        </option>
                        <option value="50">
                            50
                        </option>
                        <option value="55">
                            55
                        </option>
                        <option value="60">
                            60
                        </option>
                    </select> <label for="highsnooze">Select High Snooze
                    Minutes</label> <select id="highsnooze" name="highsnooze">
                        <option value="5">
                            5
                        </option>
                        <option value="10">
                            10
                        </option>
                        <option value="15">
                            15
                        </option>
                        <option value="20">
                            20
                        </option>
                        <option value="25">
                            25
                        </option>
                        <option value="30">
                            30
                        </option>
                        <option value="35">
                            35
                        </option>
                        <option value="40">
                            40
                        </option>
                        <option value="45">
                            45
                        </option>
                        <option value="50">
                            50
                        </option>
                        <option value="55">
                            55
                        </option>
                        <option value="60">
                            60
                        </option>
                        <option value="70">
                            70
                        </option>
                        <option value="80">
                            80
                        </option>
                        <option value="90">
                            90
                        </option>
                        <option value="100">
                            100
                        </option>
                        <option value="110">
                            110
                        </option>
                        <option value="120">
                            120
                        </option>
                    </select> <label for="lowvibe">Select Low Vibration
                    level</label> <select id="lowvibe" name="lowvibe">
                        <option value="3">
                            High
                        </option>
                        <option value="2">
                            Medium
                        </option>
                        <option value="1">
                            Low
                        </option>
                        <option value="0">
                            None
                        </option>
                    </select> <label for="highvibe">Select High Vibration
                    level</label> <select id="highvibe" name="highvibe">
                        <option value="3">
                            High
                        </option>
                        <option value="2">
                            Medium
                        </option>
                        <option value="1">
                            Low
                        </option>
                        <option value="0">
                            None
                        </option>
                    </select> <label for="vibepattern">Select Vibration
                    Pattern</label> <select id="vibepattern" name=
                    "vibepattern">
                        <option value="2">
                            Long
                        </option>
                        <option value="1">
                            Short
                        </option>
                        <option value="0">
                            None
                        </option>
                    </select> <label for="rawvibrate">Vibrate on RAW in Special
                    Values (e.g. ???)</label> <select id="rawvibrate" name=
                    "rawvibrate">
                        <option value="1">
                            Yes
                        </option>
                        <option value="0">
                            No
                        </option>
                    </select> <label for="mycolors">Colour Palette</label>
                    <select id="mycolors" name="mycolors">
                        <option value="0">
                            Blues
                        </option>
                        <option value="1">
                            Purples
                        </option>
                        <option value="2">
                            Black &amp; White
                        </option>
                        <option value="3">
                            Greens
                        </option>
                        <option value="4">
                            Multi
                        </option>
                    </select>
                    <p></p>
                    <div data-role="fieldcontain">
                        <fieldset data-role="controlgroup" data-type=
                        "horizontal" id="Radio_Options">
                            <legend><strong>Choose 12 or 24
                            hour:</strong></legend> <label><input id="12" name=
                            "TimeRadio" required="" type="radio" value="12"> 12
                            Hour</label> <label><input id="24" name="TimeRadio"
                            type="radio" value="24"> 24 Hour</label>
                        </fieldset>
                    </div>
                </div>
                <div class="ui-grid-solo">
                    <div class="ui-block-a">
                        <button data-theme="a" id="b-default" type=
                        "submit">Default Settings</button>
                    </div>
                </div>
                <div class="ui-body ui-body-b">
                    <fieldset class="ui-grid-a">
                        <div class="ui-block-a">
                            <button data-theme="d" id="b-cancel" type=
                            "submit">Cancel</button>
                        </div>
                        <div class="ui-block-b">
                            <button data-theme="a" id="b-submit" type=
                            "submit">Submit</button>
                        </div>
                    </fieldset>
                </div>
            </div>
        </div>
    </div>
    <script type='text/javascript'>
            $("#mode").on("change", function() {
                $("#" + $(this).val()).show().siblings().hide();
                $("#form-shower").show();
            });
            
            $(window).load( function() {
                if (console && console.log && console.log.call) {
                } else {
                    window.console = { log: function ( ) {
                        $('#status').text([ ].slice.call(arguments).join(' '));
                        }
                    };
                }
            
                $('#status').text('initializing');
                function saveOptions() {
                    $('#status').text('prepping save');
                    var checkradio = null;
                    var lowbg = null;
                    var highbg = null;
                    var t1name1 = null;
                    var t1name2 = null;
                    var u_name = null;
                    var p_w = null;
                    var endpoint1 = null;
                    var endpoint2 = null;

                    if ($('input[name=units]:checked').val() == 'mgdl_form'){
                        lowbg = 'mglowbg';
                        highbg = 'mghighbg';
                    } else {
                        lowbg = 'mmlowbg';
                        highbg = 'mmhighbg';
                    }
                    // establish the variables to be saved
                    if ($("#mode option:selected").val() == "US_Share") {
                        t1name1 = $("#t1name1").val();
                        t1name2 = $("#t1name2").val();

                        u_name = $("#accountName").val();
                        u_name2 = $("#accountName2").val();

                        p_w = $("#password").val();
                        p_w2 = $("#password2").val();

                        endpoint1 = "";
                        endpoint2 = "";

                    } else if ($("#mode option:selected").val() == "Non_US_Share") {
                         t1name1 = $("#t1name1").val();
                        t1name2 = $("#t1name2").val();
                        
                        u_name = $("#n_accountName").val();
                        u_name2 = $("#n_accountName2").val();

                        p_w = $("#n_password").val();
                        p_w2 = $("#n_password2").val();

                        endpoint = "";
                        endpoint2 = "";

                    } else if ($("#mode option:selected").val() == "Nightscout") {
                    	t1name1 = ""
                        u_name = ""
                        p_w = "";
                        endpoint1 = $("#endpoint1").val();
                        
                        t1name2 = ""
                        u_name2 = ""
                        p_w2 = "";
                        endpoint2 = $("#endpoint2").val();
                    }
                    var options = {
                        'mode': $("#mode option:selected").val(),
                        'endpoint1': endpoint1,
                        'endpoint2': endpoint2,
                        'accountName': u_name,
                        'accountName2': u_name2,
                        'password': p_w,
                        'password2': p_w2,
                        't1name1' : $("#t1name1").val(),
                        't1name2' : $("#t1name2").val(),
                        'radio' : $('input[name=units]:checked').val(),
                        'lowbg' : $("#" + lowbg + " option:selected").val(),
                        'highbg' : $("#" + highbg + " option:selected").val(),
                        'lowsnooze' : $("#lowsnooze option:selected").val(),
                        'highsnooze' : $("#highsnooze option:selected").val(),
                        'lowvibe' : $("#lowvibe option:selected").val(),
                        'highvibe' : $("#highvibe option:selected").val(),
                        'vibepattern' : $("#vibepattern option:selected").val(),
                        'timeformat' :  $('input[name=TimeRadio]:checked').val(),
                        'mycolors' : $("#mycolors option:selected").val(),
                        'rawvibrate' : $("#rawvibrate option:selected").val()
                    }
                    try {
                        if (window.localStorage && window.localStorage.setItem) {
                            window.localStorage.setItem('cgmOpts', JSON.stringify(options));
                        } else {
                            window.localStorage.cgmOpts =  JSON.stringify(options);
                        }
                    } catch (e) {
                        console.log('err', e);
                        options.error = e;
                    }
                    $('#status').text(['prepped', JSON.stringify(options)].join(' '));
                        return options;
                }
                function loadDefaults() {
                    var _raw = null;
                    var opts = { };
                    _raw = window.localStorage && window.localStorage.cgmOpts
                    ? window.localStorage.cgmOpts : null;
                    opts = (_raw && _raw.length && _raw.length > 5 ? JSON.parse(_raw) : { });
                    $("#mode").val(opts && opts.mode ? opts.mode : '').selectmenu("refresh");
                    
                    // load username/password to correct variables if it's Sharedata as found
                    if (opts && opts.mode) {
                        if (opts.mode == "US_Share") {
                           $("#t1name1").val(opts && opts.t1name1 ? opts.t1name1 : '');
                            $("#accountName").val(opts && opts.accountName ? opts.accountName : '');
                            $("#password").val(opts && opts.password ? opts.password : '');
                            $("#US_Share").show().siblings().hide();
                            $("#t1name2").val(opts && opts.t1name2 ? opts.t1name2 : '');
                            $("#accountName2").val(opts && opts.accountName2 ? opts.accountName2 : '');
                            $("#password2").val(opts && opts.password2 ? opts.password2 : '');
                            $("#US_Share2").show().siblings().hide();
                        } else if (opts.mode == "Non_US_Share") {
                           $("#t1name1").val(opts && opts.t1name1 ? opts.t1name1 : '');
                            $("#n_accountName").val(opts && opts.accountName ? opts.accountName : '');
                            $("#n_password").val(opts && opts.password ? opts.password : '');
                            $("#Non_US_Share").show().siblings().hide();
                            $("#t1name2").val(opts && opts.t1name2 ? opts.t1name2 : '');
                            $("#n_accountName2").val(opts && opts.accountName2 ? opts.accountName2 : '');
                            $("#n_password2").val(opts && opts.password2 ? opts.password2 : '');
                            $("#Non_US_Share2").show().siblings().hide();
                        } else if (opts.mode == "Nightscout") {
                            $("#Nightscout").show().siblings().hide();
                        }
                        $("#form-shower").show();
                    }
                    $("#endpoint1").val(opts && opts.endpoint1 ? opts.endpoint1 : '');
                    $("#endpoint2").val(opts && opts.endpoint2 ? opts.endpoint2 : '');
                    $("#accountName").val(opts && opts.accountName ? opts.accountName : '');
                    $("#accountName2").val(opts && opts.accountName2 ? opts.accountName2 : '');
                    $("#password").val(opts && opts.password ? opts.password : '');
                    $("#password2").val(opts && opts.password2 ? opts.password2 : '');
                    $("#t1name1").val(opts && opts.t1name1 ? opts.t1name1 : '');
                    $("#t1name2").val(opts && opts.t1name2 ? opts.t1name2 : '');
                    $("input[value='mmol_form']").attr("checked",false).checkboxradio("refresh");
                    $("input[value='mgdl_form']").attr("checked",true).checkboxradio("refresh");
                    document.getElementById('mgdl_form_fields').style.display = 'block';
                    document.getElementById('mmol_form_fields').style.display = 'none';
                    $("#mglowbg").val('80').selectmenu("refresh");
                    $("#mmlowbg").val('45').selectmenu("refresh");
                    $("#mghighbg").val('180').selectmenu("refresh");
                    $("#mmhighbg").val('100').selectmenu("refresh");
                    $("#lowsnooze").val('15').selectmenu("refresh");
                    $("#highsnooze").val('30').selectmenu("refresh");
                    $("#lowvibe").val('3').selectmenu("refresh");
                    $("#highvibe").val('3').selectmenu("refresh");
                    $("#vibepattern").val('2').selectmenu("refresh");
                    $("#rawvibrate").val('1').selectmenu("refresh");
                    $("#mycolors").val('0').selectmenu("refresh");
                    $("input[value='12']").attr("checked",true).checkboxradio("refresh");
                    $("input[value='24']").attr("checked",false).checkboxradio("refresh");
                }
            
                function getOptions() {
                    $('#status').text('fetching from localStorage');
                    var _raw = null;
                    var opts = { };
                    
                    if(window.localStorage.cgmOpts) {
                        _raw = window.localStorage && window.localStorage.cgmOpts
                        ? window.localStorage.cgmOpts : null;
                        opts = (_raw && _raw.length && _raw.length > 5 ? JSON.parse(_raw) : { });
                        $('#status').text(['has opts', JSON.stringify(opts)].join(' '));
                        console.log("opts", JSON.stringify(opts));
                        $("#mode").val(opts.mode).selectmenu("refresh");
                        // load username/password to correct variables if it's Sharedata as found
                        if (opts.mode) {
                            if (opts.mode == "US_Share") {
                                $("#t1name1").val(opts && opts.t1name1 ? opts.t1name1 : '');
                                $("#accountName").val(opts && opts.accountName ? opts.accountName : '');
                                $("#password").val(opts && opts.password ? opts.password : '');
                                $("#US_Share").show().siblings().hide();
                                $("#t1name2").val(opts && opts.t1name2 ? opts.t1name2 : '');
                                $("#accountName2").val(opts && opts.accountName2 ? opts.accountName2 : '');
                                $("#password2").val(opts && opts.password2 ? opts.password2 : '');
                                $("#US_Share2").show().siblings().hide();
                            } else if (opts.mode == "Non_US_Share") {
                            	$("#t1name1").val(opts && opts.t1name1 ? opts.t1name1 : '');
                                $("#n_accountName").val(opts && opts.accountName ? opts.accountName : '');
                                $("#n_password").val(opts && opts.password ? opts.password : '');
                                $("#Non_US_Share").show().siblings().hide();
                                $("#t1name2").val(opts && opts.t1name2 ? opts.t1name2 : '');
                                $("#n_accountName2").val(opts && opts.accountName2 ? opts.accountName2 : '');
                                $("#n_password2").val(opts && opts.password2 ? opts.password2 : '');
                                $("#Non_US_Share2").show().siblings().hide();                           
                                
                            } else if (opts.mode == "Nightscout") {
                                $("#Nightscout").show().siblings().hide();
                            }
                            $("#form-shower").show();
                        
                            
                        }
                        $("#endpoint1").val(opts && opts.endpoint1 ? opts.endpoint1 : '');
                        $("#endpoint2").val(opts && opts.endpoint2 ? opts.endpoint2 : '');                      
                        $("#t1name1").val(opts && opts.t1name1 ? opts.t1name1 : '');
                        $("#t1name2").val(opts && opts.t1name2 ? opts.t1name2 : '');

                        if (opts.radio == 'mgdl_form'){
                            $("input[value='" + opts.radio + "']").attr("checked",true).checkboxradio("refresh");
                            document.getElementById('mgdl_form_fields').style.display = 'block';
                            document.getElementById('mmol_form_fields').style.display = 'none';
                            $("#mglowbg").val(opts.lowbg).selectmenu("refresh");
                            $("#mghighbg").val(opts.highbg).selectmenu("refresh");
                        } else {
                            $("input[value='mgdl_form']").attr("checked",false).checkboxradio("refresh");
                            document.getElementById('mmol_form_fields').style.display = 'block';
                            document.getElementById('mgdl_form_fields').style.display = 'none';
                            $("input[value='" + opts.radio + "']").attr("checked",true).checkboxradio("refresh");
                            $("#mmlowbg").val(opts.lowbg).selectmenu("refresh");
                            $("#mmhighbg").val(opts.highbg).selectmenu("refresh");
                        }
                        $("#lowsnooze").val(opts.lowsnooze).selectmenu("refresh");
                        $("#highsnooze").val(opts.highsnooze).selectmenu("refresh");
                        $("#lowvibe").val(opts.lowvibe).selectmenu("refresh");
                        $("#highvibe").val(opts.highvibe).selectmenu("refresh");
                        $("#vibepattern").val(opts.vibepattern).selectmenu("refresh");
                        $("#rawvibrate").val(opts.rawvibrate).selectmenu("refresh");
                        $("#mycolors").val(opts.mycolors).selectmenu("refresh");
                        $("input[value='" + opts.timeformat + "']").attr("checked",true).checkboxradio("refresh");
                    } else {
                        console.log("no data");
                        $('#status').text('no data');
                        loadDefaults();
                    }
                }
                // Get query variables
                function getQueryParam(variable, defaultValue) {
                    // Find all URL parameters
                    var query = location.search.substring(1);
                    var vars = query.split('&');
                    for (var i = 0; i < vars.length; i++) {
                        var pair = vars[i].split('=');
                        
                        // If the query variable parameter is found, decode it to use and return it for use
                        if (pair[0] === variable) {
                            return decodeURIComponent(pair[1]);
                        }
                    }
                    return defaultValue || false;
                }
            
                $().ready(function() {
                    if (window.location.hash.indexOf("debug") > -1) {
                        $('#status').removeClass('hidden');
                    }
                    $('#status').text('ready');
                    $('#status').text('setting up events');

                    $("#b-cancel").click(function() {
                        console.log("Cancel");
                        $('#status').text('canceling');
                        document.location = "pebblejs://close";
                    });
                    
                    $("#b-submit").click(function() {
                        console.log("Submit");
                        
                        var return_to = getQueryParam('return_to', 'pebblejs://close#');
                        document.location = return_to + encodeURIComponent(JSON.stringify(saveOptions()));
                        
                        
                        $('#status').text('submitting');
                        
                
                    });
                    
                    $("#b-default").click(function() {
                        console.log("Default");
                        localStorage.clear();
                        loadDefaults();
                    });
                });
                $('#main').bind('pageinit', getOptions());
            });
            function onchange_handler(obj, id) {
                var other_id = (id == 'mgdl')? 'mmol' : 'mgdl';
                if(obj.checked) {
                    document.getElementById(id + '_form_fields').style.display = 'block';
                    document.getElementById(other_id + '_form_fields').style.display = 'none';
                } else {
                    document.getElementById(id + '_form_fields').style.display = 'none';
                    document.getElementById(other_id + '_form_fields').style.display = 'block';
                }
            }
            
    </script>
</body>
</html>
